<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Backtesting - NetTrade</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Backtesting";
    var mkdocs_page_input_path = "Backtesting.md";
    var mkdocs_page_url = "/Backtesting/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> NetTrade</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <span class="caption-text">Getting Started</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="..">Robot</a>
                </li>
                <li class="">
                    
    <a class="" href="../IRobotParameters/">IRobotParameters</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Backtesting</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#ibacktester-properties">IBacktester Properties</a></li>
    

    <li class="toctree-l3"><a href="#ibacktester-methods">IBacktester Methods</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../Optimization/">Optimization</a>
                </li>
                <li class="">
                    
    <a class="" href="../Indicators/">Indicators</a>
                </li>
                <li class="">
                    
    <a class="" href="../Symbol/">Symbol</a>
                </li>
                <li class="">
                    
    <a class="" href="../Bars/">Bars</a>
                </li>
                <li class="">
                    
    <a class="" href="../TradeEngine/">TradeEngine</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">NetTrade</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Getting Started &raquo;</li>
        
      
    
    <li>Backtesting</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1>Backtesting</h1>

<p>One of the main features of NetTrade is that it allows you to easily backtest a NetTrade robot. In order to backtest a NetTrade robot you have to create a backtester or use one of the available default backtesters in NetTrade.</p>
<p>To create a backtester you have to implement the "IBacktester" interface or the "Backtester" abstract class.</p>
<p>NetTrade comes with a default backtester called "OhlcBacktester"; this backtester allows you to backtest a robot on OHLC bars data. It's a very simple backtester that feeds each symbol bar to your robot.</p>
<p>OhlcBacktester code:</p>
<pre><code class="c#">    public class OhlcBacktester : Backtester
    {
        protected override async Task StartDataFeed()
        {
            var startTime = Settings.StartTime;
            var endTime = Settings.EndTime;
            var interval = Interval;

            for (var currentTime = startTime; currentTime &lt;= endTime; currentTime = currentTime.Add(interval))
            {
                bool shouldContinueDataFeed = await ShouldContinueDataFeed();

                if (!shouldContinueDataFeed)
                {
                    break;
                }

                Robot.SetTimeByBacktester(this, currentTime);

                foreach (var symbolData in SymbolsData)
                {
                    var bar = symbolData.GetBar(currentTime);

                    if (bar != null)
                    {
                        (symbolData.Symbol as OhlcSymbol).PublishBar(bar);
                    }
                }

                InvokeOnBacktestProgressChangedEvent(currentTime);
            }

            InvokeOnBacktestStopEvent();
        }
    }
</code></pre>

<p>Usage:</p>
<pre><code class="c#">        private async static void Backtest(ISymbol symbol, IEnumerable&lt;IBar&gt; data)
        {
            var startTime = data.Min(iBar =&gt; iBar.Time);
            var endTime = data.Max(iBar =&gt; iBar.Time);

            var robotParmeters = new RobotParameters
            {
                Account = new BacktestAccount(1, 1, string.Empty, 500, &quot;ConsoleTester&quot;),
                Backtester = new OhlcBacktester { Interval = TimeSpan.FromHours(1) },
                BacktestSettings = new BacktestSettings(startTime, endTime),
                Mode = Mode.Backtest,
                Server = new Server(),
                Symbols = new List&lt;ISymbol&gt; { symbol },
                SymbolsBacktestData = new List&lt;ISymbolBacktestData&gt; { new SymbolBacktestData(symbol, data) },
                Timer = new DefaultTimer(),
            };

            robotParmeters.TradeEngine = new BacktestTradeEngine(robotParmeters.Server, robotParmeters.Account);

            robotParmeters.Account.AddTransaction(new Transaction(10000, startTime));

            robotParmeters.Backtester.OnBacktestStopEvent += Backtester_OnBacktestStopEvent;
            robotParmeters.Backtester.OnBacktestProgressChangedEvent += Backtester_OnBacktestProgressChangedEvent;

            var robot = new SingleSymbolMaCrossOverBot();

            await robot.StartAsync(robotParmeters); // As the robot mode is set to &quot;Backtest&quot;, when you start the robot it starts the backtester
        }
</code></pre>

<p>As you can see you have to provide IBacktestSettings to the backtester. This object will contain some data that is needed for the backtester to operate, for example the start and end times.</p>
<p>There is a simple default implementation for this at "NetTrade.Models" called "BacktestSettings".</p>
<p>To create your own backtester you should use a "Backtester" abstract class instead of the "IBacktester" interface. You should only use the "IBacktester" interface if you wish to make some major changes.</p>
<h2 id="ibacktester-properties">IBacktester Properties</h2>
<p>Robot: The robot that is currenly under backtest.</p>
<p>Interval: The time interval for the backtester; this is the amount of time taken between each backtester loop iteration.</p>
<p>Settings: The current backtester settings.</p>
<p>SymbolsData: The symbols data for the backtester.</p>
<p>IBacktester Events</p>
<p>OnBacktestStartEvent: This event is triggered after you call the backtester StartAsync method.</p>
<p>OnBacktestPauseEvent: This event is triggered when you pause the backtester.</p>
<p>OnBacktestStopEvent: This event is triggered when you stop the backtester.</p>
<p>OnBacktestProgressChangedEvent: This event is triggered after each loop iteration, based on the defined time interval.</p>
<h2 id="ibacktester-methods">IBacktester Methods</h2>
<p>StartAsync: To start the backtester you have to call this method. It requires three parameters: the first one is the robot that you want to backtest, the second one is the backtest settings object, and the third one is the symbols data.</p>
<p>GetResult: Once the backtest is finished you can call this method to get the backtest statistics.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Optimization/" class="btn btn-neutral float-right" title="Optimization">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../IRobotParameters/" class="btn btn-neutral" title="IRobotParameters"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../IRobotParameters/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Optimization/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
